(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{218:function(a,s,t){"use strict";t.r(s);var e=t(28),v=Object(e.a)({},(function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"_4-搭建lvs-dr模式-ipvsadm配置集群规则"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-搭建lvs-dr模式-ipvsadm配置集群规则"}},[a._v("#")]),a._v(" 4.搭建LVS-DR模式-ipvsadm配置集群规则")]),a._v(" "),t("h2",{attrs:{id:"_1-创建lvs节点，用户访问的集群调度者"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-创建lvs节点，用户访问的集群调度者"}},[a._v("#")]),a._v(" 1.创建LVS节点，用户访问的集群调度者")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("ipvsadm -A -t 192.168.64.120:80 -s rr\n")])])]),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[a._v("提示")]),a._v(" "),t("ul",[t("li",[a._v("-A：增加集群")]),a._v(" "),t("li",[a._v("-t：tcp协议")]),a._v(" "),t("li",[a._v("ip地址：设定集群的访问ip，也就是LVS的虚拟ip")]),a._v(" "),t("li",[a._v("-s：设置负载均衡的算法，rr表示轮询")]),a._v(" "),t("li",[a._v("-p：设置连接持久化的时间")])])]),a._v(" "),t("h2",{attrs:{id:"_2-创建2台rs真实服务器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-创建2台rs真实服务器"}},[a._v("#")]),a._v(" 2.创建2台RS真实服务器")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("ipvsadm -a -t 192.168.64.120:80 -r 192.168.64.131:80 -g\nipvsadm -a -t 192.168.64.120:80 -r 192.168.64.131:80 -g\n")])])]),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[a._v("提示")]),a._v(" "),t("ul",[t("li",[a._v("-a：添加真实服务器")]),a._v(" "),t("li",[a._v("-t：tcp协议")]),a._v(" "),t("li",[a._v("-r：真实服务器的ip地址")]),a._v(" "),t("li",[a._v("-g：设定DR模式")])])]),a._v(" "),t("h2",{attrs:{id:"_3-保存到规则库，否则重启失效"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-保存到规则库，否则重启失效"}},[a._v("#")]),a._v(" 3.保存到规则库，否则重启失效")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("ipvsadm -S\n")])])]),t("h2",{attrs:{id:"_4-检查集群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-检查集群"}},[a._v("#")]),a._v(" 4.检查集群")]),a._v(" "),t("ul",[t("li",[t("p",[a._v("查看集群列表")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("ipvsadm -Ln\n")])])])]),a._v(" "),t("li",[t("p",[a._v("查看集群状态")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("ipvsadm -Ln --stats\n")])])])])]),a._v(" "),t("h2",{attrs:{id:"_5-其他命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-其他命令"}},[a._v("#")]),a._v(" 5.其他命令")]),a._v(" "),t("ul",[t("li",[t("p",[a._v("重启ipvsadm，重启后需要重新配置")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("service ipvsadm restart\n")])])])]),a._v(" "),t("li",[t("p",[a._v("查看持久化连接")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("ipvsadm -Ln --persistent --conn\n")])])])]),a._v(" "),t("li",[t("p",[a._v("查看连接请求过期时间以及请求源ip和目标ip")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("ipvsadm -Lnc\n")])])])]),a._v(" "),t("li",[t("p",[a._v("设置tcp tcpfin udp 的过期时间（一般保持默认）")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("ipvsadm --set 1 1 1 \n")])])])]),a._v(" "),t("li",[t("p",[a._v("查看过期时间")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("ipvsadm -Ln --timeout\n")])])])])]),a._v(" "),t("h2",{attrs:{id:"_6-更多详细的帮助文档"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-更多详细的帮助文档"}},[a._v("#")]),a._v(" 6.更多详细的帮助文档")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("ipvsadm -h\nman ipvsadm\n")])])])])}),[],!1,null,null,null);s.default=v.exports}}]);