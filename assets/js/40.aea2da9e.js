(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{244:function(t,s,a){"use strict";a.r(s);var e=a(28),r=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"nginx的upstream指令参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx的upstream指令参数"}},[t._v("#")]),t._v(" nginx的upstream指令参数")]),t._v(" "),a("h2",{attrs:{id:"_1-upstream指令参数max-conns"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-upstream指令参数max-conns"}},[t._v("#")]),t._v(" 1.upstream指令参数"),a("code",[t._v("max_conns")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("# worker进程设置1个，便于测试观察成功的连接数\nworker_processes 1;\n\nupstream tomcats {\n\tserver 192.168.64.130:8080 max_conns=2;\n\tserver 192.168.64.131:8080 max_conns=2;\n\tserver 192.168.64.132:8080 max_conns=2;\n}\n")])])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[t._v("限制每台server的连接数，用于保护避免过载，可起到限流作用。")])]),t._v(" "),a("h2",{attrs:{id:"_2-upstream指令参数slow-start"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-upstream指令参数slow-start"}},[t._v("#")]),t._v(" 2.upstream指令参数"),a("code",[t._v("slow_start")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("upstream tomcats {\n\tserver 192.168.64.130:8080 weight=6 slow_start=60s;\n\tserver 192.168.64.131:8080 weight=2;\n\tserver 192.168.64.132:8080 weight=2;\n}\n")])])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[t._v("待补充")])]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),a("p",[t._v("该参数在商业版才可以使用，开源版本无法使用")]),t._v(" "),a("p",[t._v("该参数不能使用在hash和random load balancing中")]),t._v(" "),a("p",[t._v("如果在upstream中只有一台server，则该参数失效")])]),t._v(" "),a("h2",{attrs:{id:"_3-upstream指令参数down"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-upstream指令参数down"}},[t._v("#")]),t._v(" 3.upstream指令参数"),a("code",[t._v("down")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("upstream tomcats {\n\tserver 192.168.64.130:8080 down;\n\tserver 192.168.64.131:8080 weight=2;\n\tserver 192.168.64.132:8080 weight=2;\n}\n")])])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[t._v("down 用于标记服务器节点不可用")])]),t._v(" "),a("h2",{attrs:{id:"_4-upstream指令参数backup"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-upstream指令参数backup"}},[t._v("#")]),t._v(" 4.upstream指令参数"),a("code",[t._v("backup")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("upstream tomcats {\n\tserver 192.168.64.130:8080 backup;\n\tserver 192.168.64.131:8080 weight=2;\n\tserver 192.168.64.132:8080 weight=2;\n}\n")])])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[t._v("backup 表示当前服务器节点时备用机，只有在其他服务器都宕机以后，自己才会加入到集群中，被用户访问到；")])]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("注意")]),t._v(" "),a("p",[t._v("backup 参数不能使用hash和random load balancing中")])]),t._v(" "),a("h2",{attrs:{id:"_5-upstream指令参数max-fails、fail-timeout"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-upstream指令参数max-fails、fail-timeout"}},[t._v("#")]),t._v(" 5.upstream指令参数"),a("code",[t._v("max_fails")]),t._v("、"),a("code",[t._v("fail_timeout")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("upstream tomcats {\n\tserver 192.168.64.130:8080 max_fails=2 fail_timeout=15s;\n\tserver 192.168.64.131:8080 weight=2;\n\tserver 192.168.64.132:8080 weight=2;\n}\n")])])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[t._v("max_fails：表示失败几次，则标记server已宕机，踢出上游服务器")]),t._v(" "),a("p",[t._v("fail_timeout：表示失败的重试时间")]),t._v(" "),a("p",[t._v("描述：在15秒内容请求某一server失败到达2次后，则认为该server已宕机，随后再过15秒，这15秒内不会有新的请求到达刚刚挂掉的节点上，而是会请求到正常运行的server，15秒后会再有新的请求尝试连接挂掉的server，如果还是失败，则重复上一过程，直到恢复。")])])])}),[],!1,null,null,null);s.default=r.exports}}]);